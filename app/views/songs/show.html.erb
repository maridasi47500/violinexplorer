<p id="notice"><%= notice %></p>
<div id="myid" hidden><%=@song.id%></div>

<p id="log"></p>
<%=content_for :title do%>
<%=@song.title%>
<%end%>

<style>

</style>

<p>
  <%= @song.artist %>
</p>
<div id="toselect" hidden><%=params[:my_devices]%></div>
<div id="toselectoutput" hidden><%=params[:my_devices_output]%></div>
<span>input</span> 
<%=select_tag :my_devices,options_for_select(@my_devices), {include_blank:"",selected: params[:my_devices],onchange: "window.location='#{request.path}?my_devices='+String(this.value)+'&my_devices_output'+String(my_devices_output.value)"}%>
<span>output</span>
<%=select_tag :my_devices_output,options_for_select(@my_devices), {include_blank:"",selected: params[:my_devices_output],onchange: "window.location='#{request.path}?my_devices_output='+String(this.value)+'&my_devices='+String(my_devices.value)"}%>
      <header>

        <h1>
<%=@song.title%></h1>
	<div id="controls">
		<img id="record" src="/img/mic128.png" onclick="toggleRecording(this);">
<form id="myvideoform"> </form>
<form id="myform"><div><!-- comment -->

<%=label_tag :mycontent, "Texte de mon message"%>
<%=select_tag :mycontent,  options_from_collection_for_select(@mymessages, "id", "content"), include_blank: "texte du message que j'ai enregistré"%> </form>
</div><a id="save" href="#"><img src="/img/save.svg"></a>
	</div>


      </header>
   <div class="wrapper">


<div id="viz">
		<canvas id="analyser" width="1024" height="50"></canvas>
		<canvas id="wavedisplay" width="1024" height="50"></canvas>
	</div>


      </section>


<div class="accompaniment">
  <h4>accompagnement</h4>
<%if Dir.glob(Rails.root.to_s+"/public/uploads/**.mp3").any?{|x|x.include?(@song.title.parameterize+@song.artist.parameterize+".mp3")}%>


   <audio  preload="none" id="mysong" controls>
  <source  src="/uploads/<%=@song.title.parameterize+@song.artist.parameterize%>.mp3" type="audio/mp3">
  Your browser does not support the audio tag.
</audio>
<%end%>
<%if @song.title.downcase.include?("carnaval") and @song.title.downcase.include?("animaux")%>
    <ul>
        <li><a onclick="mysong1.currentTime=0;mysong1.play();return false;"  href="#">&#8987; I – Introduction et Marche royale du lion 🦁</a></li>
        <li><a onclick="mysong1.currentTime=140;mysong1.play();return false;"  href="#">&#128019; II – Poules et Coqs 🐓</a></li>
        <li><a onclick="mysong1.currentTime=200;mysong1.play();return false;"  href="#">&#128007; III – Hémiones (ou Animaux véloces) 🐎</a></li>
        <li><a onclick="mysong1.currentTime=236;mysong1.play();return false;"  href="#">&#128034; IV – Tortues 🐢</a></li>
        <li><a onclick="mysong1.currentTime=300;mysong1.play();return false;"  href="#">&#128024; V – L'Éléphant 🐘</a></li>
        <li><a onclick="mysong1.currentTime=400;mysong1.play();return false;"  href="#">&#129432; VI – Kangourous 🦘</a></li>
        <li><a onclick="mysong1.currentTime=451;mysong1.play();return false;"  href="#">&#128032; VII – Aquarium 🐠</a></li>
        <li><a onclick="mysong1.currentTime=607;mysong1.play();return false;"  href="#">&#128054; VIII – Personnages à longues oreilles 🐶</a></li>
        <li><a onclick="mysong1.currentTime=648;mysong1.play();return false;"  href="#">&#129417; IX – Le Coucou au fond des bois 🕊️</a></li>
        <li><a onclick="mysong1.currentTime=766;mysong1.play();return false;"  href="#">&#128038; X – Volière 🦜</a></li>
        <li><a onclick="mysong1.currentTime=857;mysong1.play();return false;"  href="#">&#127929; XI – Pianistes 🎹</a></li>
        <li><a onclick="mysong1.currentTime=939;mysong1.play();return false;"  href="#">&#129426; XII – Fossiles 🦴</a></li>
        <li><a onclick="mysong1.currentTime=1000;mysong1.play();return false;"  href="#">&#128031; XIII – Le Cygne 🦢</a></li>
        <li><a onclick="mysong1.currentTime=1176;mysong1.play();return false;"  href="#">&#127880; XIV – Finale 🎉</a></li>
    </ul>

<%end%>
  <%=form_with model: @song do |form|%>
    <%=form.file_field :myfile%>
    <%=form.submit "ajouter le morceau"%>
  <%end%>
  <label hidden for="recordpart"> enregistrer la partie seule (avec  l'accompagnement)
      <input hidden id="recordpart" type="checkbox" name="recordpart" value="1" /></label>

  <h4>accompagnement</h4>
<%@song.accompaniments.each_with_index do |acc,i|%>
  <label for="myaccomp<%=acc.id%>" hidden>enregistrer avec cet accompagnement de piano</label>
  <input hidden  id="myaccomp<%=acc.id%>" type="radio" name="myaccomp" value="<%=acc.id%>" />
<span class="recordingnb">Accompagnement n°<%=i+1%></span>

   <audio  preload="none" id="mysong<%=acc.id%>" controls>
  <source  src="/uploads/<%=acc.filename%>" id="myaccompaniment<%i+1%>" type="audio/mp3">
  Your browser does not support the audio tag.
</audio>
<%end%>

</div>

<div id="overlay">
  <div id="text">Overlay Text</div>
</div>


<%= link_to 'Filmer', vids_song_path(@song) %> |
<%= link_to 'Edit', edit_song_path(@song) %> |
<%= link_to 'Back', songs_path %>
<%=content_for :js do%>
<script src="/js/audiodisplay.js"></script>
        <script src="/js/recorderjs/recorder.js"></script>
        <script src="/js/main.js"></script>
<%end%>
